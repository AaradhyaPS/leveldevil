<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Level Devil Style Game</title>
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<style>
    body { margin:0; background:#111; overflow:hidden; }
    canvas { display:block; margin:0 auto; background:#87CEEB; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = 900;
canvas.height = 500;

let keys = {};
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

class Player {
    constructor(){
        this.x = 100;
        this.y = 350;
        this.w = 35;
        this.h = 50;
        this.vx = 0;
        this.vy = 0;
        this.onGround = false;
    }

    update(){
        this.vy += 0.7; // gravity

        if(keys["a"] || keys["ArrowLeft"]) this.vx = -4;
        else if(keys["d"] || keys["ArrowRight"]) this.vx = 4;
        else this.vx = 0;

        if((keys[" "] || keys["w"] || keys["ArrowUp"]) && this.onGround){
            this.vy = -14;
            this.onGround = false;
        }

        this.x += this.vx;
        this.y += this.vy;

        // collisions
        this.onGround = false;
        for(let p of platforms){
            if(this.x + this.w > p.x && this.x < p.x + p.w){
                if(this.y + this.h > p.y && this.y + this.h < p.y + 20 && this.vy >= 0){
                    this.y = p.y - this.h;
                    this.vy = 0;
                    this.onGround = true;
                }
            }
        }

        // spike death
        for(let s of spikes){
            if(this.x + this.w > s.x && this.x < s.x + s.w &&
               this.y + this.h > s.y && this.y < s.y + s.h){
                resetGame();
            }
        }

        // fake floor (falls)
        for(let f of fakeFloors){
            if(!f.broken && this.x + this.w > f.x && this.x < f.x + f.w &&
               this.y + this.h > f.y && this.y < f.y + f.h){
                f.broken = true;
            }
            if(f.broken) f.y += 6;
        }
    }

    draw(){
        ctx.fillStyle = "black";
        ctx.fillRect(this.x - camX, this.y, this.w, this.h);
    }
}

class Platform {
    constructor(x,y,w){
        this.x=x; this.y=y; this.w=w; this.h=20;
    }
    draw(){
        ctx.fillStyle="#444";
        ctx.fillRect(this.x - camX, this.y, this.w, this.h);
    }
}

class Spike {
    constructor(x,y){
        this.x=x; this.y=y; this.w=30; this.h=30;
    }
    draw(){
        ctx.fillStyle="red";
        ctx.beginPath();
        ctx.moveTo(this.x - camX, this.y+30);
        ctx.lineTo(this.x - camX + 15, this.y);
        ctx.lineTo(this.x - camX + 30, this.y+30);
        ctx.fill();
    }
}

class FakeFloor {
    constructor(x,y,w){
        this.x=x; this.y=y; this.w=w; this.h=15;
        this.broken=false;
    }
    draw(){
        ctx.fillStyle = this.broken ? "#663300" : "#996633";
        ctx.fillRect(this.x - camX, this.y, this.w, this.h);
    }
}


// LEVEL DESIGN
let platforms = [];
let spikes = [];
let fakeFloors = [];

function buildLevel(){
    platforms.push(new Platform(0,400,900));
    platforms.push(new Platform(900,400,900));
    platforms.push(new Platform(1800,400,900));

    // spike traps
    spikes.push(new Spike(300,370));
    spikes.push(new Spike(1100,370));
    spikes.push(new Spike(1600,370));

    // fake floors
    fakeFloors.push(new FakeFloor(600,390,100));
    fakeFloors.push(new FakeFloor(1450,390,120));

    // moving platform
    movingPlatform = {x:2000,y:320,w:150,dir:1};
}

let movingPlatform;
let camX = 0;
const player = new Player();

function resetGame(){
    player.x = 100;
    player.y = 350;
    fakeFloors.forEach(f=>f.broken=false);
}

buildLevel();

function update(){
    player.update();

    // moving platform logic
    movingPlatform.x += 2 * movingPlatform.dir;
    if(movingPlatform.x > 2300) movingPlatform.dir = -1;
    if(movingPlatform.x < 1800) movingPlatform.dir = 1;

    // collision with moving platform
    if(player.x + player.w > movingPlatform.x &&
       player.x < movingPlatform.x + movingPlatform.w &&
       player.y + player.h > movingPlatform.y &&
       player.y + player.h < movingPlatform.y + 20 &&
       player.vy >= 0){
           player.y = movingPlatform.y - player.h;
           player.vy = 0;
           player.onGround = true;
    }

    // camera follow
    camX = player.x - 200;
    if(camX < 0) camX = 0;
}

function draw(){
    ctx.clearRect(0,0,canvas.width,canvas.height);

    // sky
    ctx.fillStyle="#87CEEB";
    ctx.fillRect(0,0,canvas.width,canvas.height);

    // ground/platforms
    platforms.forEach(p=>p.draw());

    // moving platform
    ctx.fillStyle="#555";
    ctx.fillRect(movingPlatform.x - camX, movingPlatform.y, movingPlatform.w, 20);

    // spikes
    spikes.forEach(s=>s.draw());

    // fake floors
    fakeFloors.forEach(f=>f.draw());

    player.draw();
}

function loop(){
    update();
    draw();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
